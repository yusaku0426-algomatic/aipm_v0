---
description: ã€Œæ—¥æ¬¡ã‚¿ã‚¹ã‚¯ãƒ»é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆã—ã€å®Œäº†ã‚¿ã‚¹ã‚¯ã‚’ WBS ã‚„ãƒªã‚¹ã‚¯ãƒ­ã‚°ã¸åŒæœŸã™ã‚‹ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ«ãƒ¼ãƒ«ã€
globs: 
alwaysApply: false
---
# =========================
# 07_task_management.mdc
# =========================
path_reference: "pmbok_paths.mdc"

#----------------------------------------------------------
# å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³
#----------------------------------------------------------
patterns:
  wbs_glob:          "{{dirs.stock}}/projects/*/documents/3_planning/wbs.md"
  backlog_glob:      "{{dirs.stock}}/projects/*/documents/3_planning/backlog/**/*.yaml"
  daily_template:    "{{rules_basic_templates}}/daily_tasks_template.md"
  weekly_template:   "{{rules_basic_templates}}/weekly_review_template.md"
  daily_md:          "{{dirs.flow}}/{{today}}/daily_tasks.md"
  weekly_md:         "{{dirs.flow}}/{{iso_week_end}}/weekly_review.md"

# =========================
# 1. Daily Tasks
# =========================
daily_tasks:
  trigger:
    - pattern: "(ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯|æ—¥æ¬¡ã‚¿ã‚¹ã‚¯ä½œæˆ|Daily tasks)"
    - time: "09:00"               # å¹³æ—¥ AM9:00 è‡ªå‹•
  steps:
    # 1) Stock ã‹ã‚‰ã‚¿ã‚¹ã‚¯æŠ½å‡º
    - collect_tasks:
        sources:
          - glob: "{{patterns.wbs_glob}}"
          - glob: "{{patterns.backlog_glob}}"
        rules:
          due_within_days: 3       # 3æ—¥ä»¥å†…æœŸé™ â†’ HIGH
          sort_by: ["priority","due"]
        store_as: tasks_today

    # 2) Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆå®šã‚‚å–å¾— (MCP ã‚³ãƒãƒ³ãƒ‰)
    - execute_shell:
        command: "mcp calendar today --json"
        store_as: calendar_json

    # 3) ãƒ†ãƒ³ãƒ—ãƒ¬ã«è‡ªå‹•å·®ã—è¾¼ã¿
    - create_markdown_file:
        path: "{{patterns.daily_md}}"
        template_path: "{{patterns.daily_template}}"
        variables:
          date: "{{today}}"
          calendar: "{{calendar_json}}"
          tasks: "{{tasks_today}}"

    # 4) æœªå®Œäº†ã‚¿ã‚¹ã‚¯é€šçŸ¥
    - notify_overdue:
        lookback_days: 1
        file_pattern: "{{dirs.flow}}/*/daily_tasks.md"
        message_template: "ğŸ”” å‰æ—¥ã¾ã§ã®æœªå®Œäº†ã‚¿ã‚¹ã‚¯: **{{count}}ä»¶**"

    - notify:
        message: |
          âœ… æ—¥æ¬¡ã‚¿ã‚¹ã‚¯ã‚’ç”Ÿæˆã—ã¾ã—ãŸ â†’ {{patterns.daily_md}}
          ã€Œå®Œäº†ã—ãŸã‚‰ [x] ã«ãƒãƒ¼ã‚¯ â†’ 'Sync' ã§ WBS ã¸åæ˜ ã§ãã¾ã™ã€

# =========================
# 2. Weekly Review (é‡‘æ›œ 17 : 30)
# =========================
weekly_review:
  trigger:
    - pattern: "(é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼|Weekly review)"
    - time: "é‡‘ 17:30"
  steps:
    - aggregate_week:
        flow_glob: "{{dirs.flow}}/{{iso_week}}*/daily_tasks.md"
        store_as: week_data
    - create_markdown_file:
        path: "{{patterns.weekly_md}}"
        template_path: "{{patterns.weekly_template}}"
        variables:
          week_data: "{{week_data}}"
          iso_week: "{{iso_week}}"
    - sync_progress:
        source: "{{week_data.completed}}"
        wbs_glob: "{{patterns.wbs_glob}}"
        risk_glob: "{{dirs.stock}}/projects/*/documents/3_planning/risk_log.md"
    - notify:
        message: |
          ğŸ“’ é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã—ãŸ â†’ {{patterns.weekly_md}}
          ç¢ºèªå¾Œã€Œç¢ºå®šåæ˜ ã—ã¦ã€ã§ Stock ã«ç§»å‹•ã—ã¾ã™

# =========================
# 3. Sync Command (æ‰‹å‹•)
# =========================
sync_with_artifacts:
  trigger:
    - pattern: "(Sync|WBSã¨åŒæœŸ|ãƒªã‚¹ã‚¯ãƒ­ã‚°ã¨åŒæœŸ)"
  steps:
    - parse_daily:
        file: "{{patterns.daily_md}}"
        store_as: done_today
    - sync_wbs:
        completed: "{{done_today}}"
        wbs_glob: "{{patterns.wbs_glob}}"
    - sync_risk_log:
        completed: "{{done_today}}"
        risk_glob: "{{dirs.stock}}/projects/*/documents/3_planning/risk_log.md"
    - notify:
        message: "WBS / ãƒªã‚¹ã‚¯ãƒ­ã‚°ã¸åŒæœŸã—ã¾ã—ãŸ âœ…"
